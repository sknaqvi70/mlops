"PROGRAM\_ID BSH02SYR01



&nbsp;	Declare 



&nbsp;	-- Declare a cursor that reads the Program Structure for given program

&nbsp;	Cursor NPS IS

 		SELECT NPS\_SSM\_ID, NPS\_GRP\_ID, NPS\_MIN\_CREDITS, NPS\_MAX\_CREDITS FROM NEP\_PROGRAM\_STRUCTURE

 		WHERE NPS\_SSM\_ID = PROGRAM\_ID;



&nbsp;	-- Declare a cursor that reads the Subjects of the courses prescribed for the program

&nbsp;	Cursor SUBJECTS\_CURSOR(COURSE\_TYPE\_CGP\_GRP\_ID VARCHAR2(6)) IS

 		Select DISTINCT NCI\_SBM\_ID AS SBM\_ID

 		FROM NEP\_COURSES\_IMPORT

 		WHERE INSTR(NCI\_PERMITTED\_COHORTS, PROGRAM\_ID) > 0  and NCI\_GRP\_ID = COURSE\_TYPE\_CGP\_GRP\_ID

 				and TO\_NUMBER(SUBSTR(PROGRAM\_ID,9,2)) = NCI\_SEMESTER\_IN\_WHICH\_OFFERED



&nbsp;	Cursor SUBJECT\_PAPERS\_CURSOR(COURSE\_TYPE\_CGP\_GRP\_ID VARCHAR2(6)) IS

 		SELECT NCI\_COURSE\_CODE, NCI\_COURSE\_TYPE, NCI\_DEP\_ID, NCI\_GRP\_ID, NCI\_SBM\_ID,

 			NCI\_COURSE\_TITLE, NCI\_PERMITTED\_COHORTS, NCI\_NO\_OF\_CREDITS, NCI\_SEMESTER\_IN\_WHICH\_OFFERED,

 			NCI\_ADMISSION\_POLICY, NCI\_NO\_OF\_SEATS, NCI\_COURSE\_COORDINATOR\_EMAIL, NCI\_PREREQUISITES,

 			NCI\_COURSE\_PAGE\_LINK, NCI\_SESSION\_ID

 		FROM NEP\_COURSES\_IMPORT

 		WHERE 	INSTR(NCI\_PERMITTED\_COHORTS, PROGRAM\_ID) > 0 AND 

&nbsp;			NCI\_GRP\_ID =  COURSE\_TYPE\_CGP\_GRP\_ID AND

 			TO\_NUMBER(SUBSTR(:PROGRAM\_ID,9,2)) = NCI\_SEMESTER\_IN\_WHICH\_OFFERED AND 

&nbsp;			NCI\_SBM\_ID = SUBJECT.SBM\_ID;



 	CRS\_GRP\_CNT NUMBER := 0;

 	CRS\_SUB\_GRP\_CNT NUMBER := 0;

 	CSG\_ID\_CNT NUMBER := 0;

&nbsp;	PAPER\_CNT NUMBER := 0;



&nbsp;	-- For each type of course in the Program Structure; run the following loop

 	FOR COURSE\_TYPE IN NPS LOOP

 		--FIND IF COURSE TYPE IS PRESENT IN COURSE\_GROUP

 		CRS\_GRP\_CNT := 0;

 		SELECT NVL(COUNT(CGP\_GRP\_ID),0) INTO CRS\_GRP\_CNT  FROM COURSE\_GROUPS

 		WHERE 	CGP\_SSM\_ID = PROGRAM\_ID AND

 			CGP\_GRP\_ID = COURSE\_TYPE.NPS\_GRP\_ID;

 

 		IF CRS\_GRP\_CNT = 0 THEN

 			INSERT INTO COURSE\_GROUPS (CGP\_SSM\_ID, CGP\_GRP\_ID) VALUES (COURSE\_TYPE.NPS\_SSM\_ID, COURSE\_TYPE.CGP\_GRP\_ID);

 		END IF;



 		--FIND IF COURSE TYPE IS PRESENT IN COURSE\_SUB\_GROUP



 		SELECT NVL(COUNT(CSG\_ID),0) INTO CRS\_SUB\_GRP\_CNT  FROM COURSE\_SUB\_GROUPS

 		WHERE 	CSG\_SSM\_ID = PROGRAM\_ID AND

 			CSG\_GRP\_ID = COURSE\_TYPE.NPS\_GRP\_ID AND

 			CSG\_SGRP\_ID = COURSE\_TYPE.NPS\_GRP\_ID;



 		IF CRS\_SUB\_GRP\_CNT = 0 THEN

 			SELECT MAX(CSG\_ID) INTO CSG\_ID\_CNT FROM COURSE\_SUB\_GROUPS;

&nbsp;			CSG\_ID\_CNT := CSG\_ID\_CNT + 1;

 			INSERT INTO COURSE\_SUB\_GROUPS (CSG\_ID, CSG\_SSM\_ID, CSG\_GRP\_ID, CSG\_SGRP\_ID, CSG\_NO\_SUBJECTS, CSG\_MAX\_NO\_SUBJECTS,

 							CSG\_MIN\_NO\_CREDITS, CSG\_MAX\_NO\_CREDITS) VALUES

 					(CSG\_ID\_CNT, COURSE\_TYPE.NPS\_SSM\_ID, COURSE\_TYPE.NPS\_GRP\_ID, COURSE\_TYPE.NPS\_GRP\_ID, 0,0,

 					COURSE\_TYPE.NPS\_MIN\_CREDITS, COURSE\_TYPE.NPS\_MAX\_CREDITS);

&nbsp;			

&nbsp;			

&nbsp;			 	SELECT MAX(SDD\_CSG\_ID) INTO SDD\_CSG\_ID\_CNT FROM SUBJECT\_DISCIPLINE\_DTL;

 				SDD\_CSG\_ID\_CNT := SDD\_CSG\_ID\_CNT + 1;

 			

&nbsp;				FOR SUBJECT IN SUBJECT\_CURSOR(COURSE\_TYPE.CGP\_GRP\_ID)  LOOP

&nbsp;					

&nbsp;					--FIND NUMBER OF PAPERS FOR THE SUBJECTS CORRESPONDING TO THE COURSE TYPE IN THE OUTER CURSOR

&nbsp;					Select COUNT(NCI\_COURSE\_CODE) INTO PAPER\_CNT 						

&nbsp;					FROM NEP\_COURSES\_IMPORT

 					WHERE 	INSTR(NCI\_PERMITTED\_COHORTS, PROGRAM\_ID) > 0 AND

&nbsp;						NCI\_GRP\_ID = COURSE\_TYPE.CGP\_GRP\_ID AND 

&nbsp;						TO\_NMBER(SUBSTR(PROGRAM\_ID,9,2)) = NCI\_SEMESTER\_IN\_WHICH\_OFFERED AND

&nbsp;						SUBJECT.SBM\_ID = NCI\_SBM\_ID;

&nbsp;						

&nbsp;						-- IF SUBJECTS EXISTS ADD SUBJECT AND CORRESPONDING COURSES 

&nbsp;					 	INSERT INTO SUBJECT\_DISCIPLINE\_DTL(SDD\_CSG\_ID, SDD\_SBM\_ID, SDD\_COMP\_ELECT, SDD\_NO\_PAPERS,

&nbsp;									SDD\_TOT\_AGG, SDD\_EFF\_DT, SDD\_CLOSE\_DT, SDD\_PRINT ) VALUES

 								   	(SDD\_CSG\_ID\_CNT,SUBJECT.NCI\_SBD\_ID, NULL, PAPER\_CNT, 100, 

&nbsp;									START\_DATE,NULL,'Y');

&nbsp;						FOR PAPER IN SUBJECT\_PAPERS\_CURSOR((COURSE\_TYPE.CGP\_GRP\_ID)) LOOP

&nbsp;							SELECT MAX(SBT\_SBD\_ID) INTO SBT\_SBD\_ID\_CNT FROM SUBJECT\_DTL;

&nbsp;							SBT\_SBD\_ID\_CNT := SBT\_SBD\_ID\_CNT + 1;



&nbsp;							INSERT INTO SUBJECT\_DTL(SBT\_CSG\_ID, SBT\_SBD\_ID, SBT\_TYPE, SBT\_SBM\_ID, SBT\_COMP\_ELECT, 

&nbsp;										SBT\_LEC\_HRS, SBT\_STUDIO\_TUTOR, SBT\_TUT\_HRS, SBT\_EXAM\_DURATION, 

&nbsp;										SBT\_END\_MARKS, SBT\_ENDPASS\_MARKS, SBT\_MID\_MARKS, SBT\_MIDPASS\_MARKS,

&nbsp;										SBT\_TOTPASS\_MARKS, SBT\_EFF\_DT, SBT\_CLOSE\_DT, SBT\_PAPER\_CODE, 

&nbsp;										SBT\_MIN\_CREDITS, SBT\_MAX\_CREDITS) VALUES 

&nbsp;										(SDD\_CSG\_ID\_CNT, SBT\_SBD\_ID\_CNT, 'SBM001',PAPER.NCI\_SBM\_ID, NULL,

&nbsp;										PAPER.NCI\_NO\_OF\_CREDITS, 'T',PAPER.NCI\_NO\_OF\_CREDITS, 2, 70, 21, 

&nbsp;										30,10,31, START\_DATE, NULL, PAPER.NCI\_COURSE\_CODE, 

&nbsp;										NULL, PAPER.NCI\_NO\_OF\_CREDITS);

FROM 	

&nbsp;						END LOOP;



&nbsp;					END LOOP;

&nbsp;			

&nbsp;			





&nbsp;			INSERT INTO SUBJECT\_DISCIPLINE\_DTL(SDD\_CSG\_ID, SDD\_SBM\_ID, SDD\_COMP\_ELECT, SDD\_NO\_PAPERS, 

&nbsp;							SDD\_TOT\_AGG, SDD\_EFF\_DT, SDD\_CLOSE\_DT, SDD\_PRINT) VALUES 

&nbsp;			(SDD\_CSG\_ID\_CNT, ) 

 		ELSIF CRS\_SUB\_GRP\_CNT = 1 THEN

 			UPDATE COURSE\_SUB\_GROUPS SET

 				CSG\_MIN\_NO\_CREDITS = COURSE\_TYPE.NPS\_MIN\_CREDITS,

 				CSG\_MAX\_NO\_CREDITS = COURSE\_TYPE.NPS\_MAX\_CREDITS

 			WHERE 	CSG\_SSM\_ID = PROGRAM\_ID AND

 				CSG\_GRP\_ID = COURSE\_TYPE.NPS\_GRP\_ID AND

 				CSG\_SGRP\_ID = COURSE\_TYPE.NPS\_GRP\_ID; 

 

 		END IF;

